<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Message for You</title>
    <link rel="icon" href="heart-favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #e5e5e5;
            font-family: 'Amiri', serif;
            /* Allow scrolling now */
            overflow-x: hidden; 
            overflow-y: auto;
        }

        /* --- THE CARD MECHANICS (3D Flip) --- */
        .perspective-container {
            perspective: 1200px;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy professional feel */
            transform-style: preserve-3d;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            will-change: transform; /* Performance fix */
        }

        .card-flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
            border: 8px solid white; /* Photo border effect */
            background: white;
            will-change: transform; /* Performance fix */
        }

        .card-back {
            transform: rotateY(180deg);
            background-color: #fffbf0; /* Warm paper color */
            background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png"); /* Subtle texture */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- THE ENVELOPE ANIMATION --- */
        .envelope-container {
            transition: transform 0.8s ease-in, opacity 0.8s ease-in;
            z-index: 40;
        }
        .envelope-open {
            transform: translateY(120vh) rotate(-5deg); /* Slide down and tilt */
            opacity: 0;
            pointer-events: none;
        }
        
        /* --- ORIENTATION LOCK --- */
        #orientation-warning { 
            display: none; 
            z-index: 100; 
            transition: opacity 1s ease-out;
        }
        
        /* If Portrait (Vertical), we might show it via JS, but we won't hide main content via CSS anymore */
    </style>
</head>
<body class="bg-stone-200 min-h-screen w-screen flex items-center justify-center p-4">

    <!-- Warning Overlay -->
    <div id="orientation-warning" class="fixed inset-0 bg-stone-900/90 text-white flex-col items-center justify-center text-center p-8 backdrop-blur-sm cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mb-6 animate-bounce text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <h2 class="text-3xl font-bold mb-4" style="direction: rtl;">Better in Landscape</h2>
        <p class="text-stone-300 text-lg mb-8">Rotating your phone gives a better view.</p>
        <p class="text-stone-500 text-sm">(Tap to dismiss or wait...)</p>
    </div>

    <!-- Lightbox Overlay -->
    <div id="lightbox" class="fixed inset-0 bg-black/95 z-[200] hidden flex-col items-center justify-center p-4 cursor-pointer transition-opacity duration-300 opacity-0">
        <div class="absolute top-4 right-4 text-white hover:text-gray-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </div>
        <img id="lightbox-img" src="" class="max-w-full max-h-full object-contain shadow-2xl rounded-sm" alt="Full Screen Note">
        <p class="text-stone-400 mt-4 text-sm">Tap anywhere to close</p>
    </div>

    <!-- Main Stage: constrained max-width for better card shape -->
    <div id="main-stage" class="relative w-full max-w-4xl flex items-center justify-center">
        
        <!-- Envelope -->
        <div id="envelope" class="envelope-container absolute inset-0 flex flex-col items-center justify-center bg-[#fdfdfd] shadow-2xl rounded-lg cursor-pointer border border-stone-200 z-50 h-[300px] md:h-[400px] w-full max-w-2xl mx-auto my-auto">
            
            
            <div class="text-center z-10 p-4">
                <p class="text-stone-400 text-xl md:text-xl uppercase tracking-[0.2em] mb-0">A Special Message For You</p>
                <p class="text-stone-400 text-xs md:text-sm lowercase tracking-[0.2em] mb-4">Cause it won't be, if it's 'select all'</p>
                <h1 id="recipient-name" class="text-4xl md:text-6xl font-bold text-stone-800 mb-6" style="direction: rtl;">...</h1>
                
                <div class="mt-4 inline-block px-6 py-2 bg-stone-800 text-white rounded-full text-xs md:text-sm font-semibold tracking-wide shadow-lg hover:bg-black transition-colors">
                    Click To Open
                </div>
            </div>
        </div>

        <!-- 
            Card Container
            Aspect ratio will be set dynamically via JS based on the image content.
            Defaulting to something reasonable just in case.
        -->
        <div id="card-container" class="perspective-container w-full max-h-[80vh] cursor-pointer opacity-0 transition-opacity duration-700 delay-300">
            <div class="card-inner" id="card-inner">
                
                <div class="card-front">
                    <img src="group-sketch.jpg" class="w-full h-full object-cover" alt="Team Sketch">
                    
                    <div class="absolute bottom-6 right-6 bg-black/60 text-white px-4 py-2 rounded-full text-sm backdrop-blur-md flex items-center gap-2">
                        <span>Tap to Flip</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    </div>
                </div>

                <div class="card-back relative p-4 group">
                    <img id="note-image" src="" class="w-full h-full object-contain drop-shadow-md" alt="Handwritten Note">
                    
                    <!-- Expand Button Overlay -->
                    <div id="expand-btn" class="absolute inset-0 flex items-center justify-center bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-xl">
                         <div class="bg-black/70 text-white px-4 py-2 rounded-full backdrop-blur-md flex items-center gap-2 hover:scale-105 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                            </svg>
                            <span class="text-sm font-semibold">Tap to Fullscreen</span>
                        </div>
                    </div>
                    <!-- Always visible on mobile hint -->
                    <div class="absolute bottom-2 right-2 md:hidden bg-black/50 text-white p-2 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // CONFIGURATION: Add your friends here
        // ==========================================
        const recipients = {
            "anwar>3": { 
                name: "Anwar",           // The name shown on the envelope
                file: "anwar.jpg"        // The filename of their note
            },
            "mostafa>3": { 
                name: "Mostafa",           // The name shown on the envelope
                file: "mostafa.jpg"        // The filename of their note
            }
            ,
            "clarck001": { 
                name: "Clark",           // The name shown on the envelope
                file: "clarck.jpg"        // The filename of their note
            },
            "demiery003": { 
                name: "Demiery",           // The name shown on the envelope
                file: "demiery.jpg"        // The filename of their note
            },
            "010gemy": { 
                name: "Gemy",           // The name shown on the envelope
                file: "gemy.jpg"        // The filename of their note
            },
            "haboba": { 
                name: "Habiba",           // The name shown on the envelope
                file: "habiba.jpg"        // The filename of their note
            },
            "hafezzz": { 
                name: "Hafez",           // The name shown on the envelope
                file: "hafez.jpg"        // The filename of their note
            },
            "shadysz": { 
                name: "Shady",           // The name shown on the envelope
                file: "shady.jpg"        // The filename of their note
            },
            "sihoo": { 
                name: "Soha",           // The name shown on the envelope
                file: "soha.jpg"        // The filename of their note
            },
            "tahataha": { 
                name: "Taha",           // The name shown on the envelope
                file: "taha.jpg"        // The filename of their note
            },
            "yehiamorsy": { 
                name: "Yehia",           // The name shown on the envelope
                file: "yehia.jpg"        // The filename of their note
            },
            "kareemAhmed": { 
                name: "Kareem",           // The name shown on the envelope
                file: "kareem.jpg"        // The filename of their note
            }
            ,
            "hamdy": { 
                name: "Hamdy",           // The name shown on the envelope
                file: "hamdy.jpg"        // The filename of their note
            },
            "zizo": { 
                name: "Zizo",           // The name shown on the envelope
                file: "zizo.jpg"        // The filename of their note
            },
            "farahat": { 
                name: "Farahat",           // The name shown on the envelope
                file: "farahat.jpg"        // The filename of their note
            },
            "kareemAli": { 
                name: "Kareem",           // The name shown on the envelope
                file: "kareemAli.jpg"        // The filename of their note
            },
            "marsilll": { 
                name: "Marsil",           // The name shown on the envelope
                file: "marsil.jpg"        // The filename of their note
            }
            // Add more lines here...
        };

        // ==========================================
        // MAIN LOGIC
        // ==========================================
        const urlParams = new URLSearchParams(window.location.search);
        const userKey = urlParams.get('to'); 
        
        // 1. THE GHOST CHECK
        if (!userKey || !recipients[userKey]) {
            document.body.innerHTML = ""; 
        } else {
            // 2. LOAD DATA
            const data = recipients[userKey];
            document.getElementById('recipient-name').innerText = data.name;
            
            const noteImg = document.getElementById('note-image');
            const cardContainer = document.getElementById('card-container');
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const expandBtn = document.getElementById('expand-btn');

            // Set image source
            noteImg.src = data.file;

            // DYNAMIC FIT: Adjust card shape to match photo
            noteImg.onload = function() {
                const w = this.naturalWidth;
                const h = this.naturalHeight;
                
                // If it's a portrait photo (taller than wide)
                if (h > w) {
                    // Use a vertical aspect ratio, e.g. 3:4 or just use the exact ratio
                    cardContainer.style.aspectRatio = `${w} / ${h}`;
                    cardContainer.style.maxWidth = "500px"; // Limit width so it doesn't get too huge vertically
                } else {
                    // Landscape
                    cardContainer.style.aspectRatio = `${w} / ${h}`;
                    cardContainer.style.maxWidth = "800px";
                }
            };

            // 3. ANIMATION HANDLERS
            const envelope = document.getElementById('envelope');
            // const cardContainer already defined above
            const cardInner = document.getElementById('card-inner');
            const warningCallback = document.getElementById('orientation-warning');

            let hasFlipped = false;

            // --- ORIENTATION WARNING LOGIC ---
            function checkOrientation() {
                // If in portrait mode
                if (window.innerHeight > window.innerWidth) {
                    warningCallback.style.display = 'flex';
                    // Auto hide after 4 seconds
                    setTimeout(() => {
                        warningCallback.style.opacity = '0';
                        setTimeout(() => warningCallback.style.display = 'none', 1000);
                    }, 4000);
                }
            }
            // Run on load
            checkOrientation();

            // Allow manual dismiss
            warningCallback.addEventListener('click', () => {
                warningCallback.style.opacity = '0';
                setTimeout(() => warningCallback.style.display = 'none', 1000);
            });


            // --- ENVELOPE OPEN ---
            envelope.addEventListener('click', () => {
                envelope.classList.add('envelope-open');
                cardContainer.classList.remove('opacity-0');
                
                // Hide envelope after animation
                setTimeout(() => {
                    envelope.style.display = 'none';
                }, 800);

                // --- AUTO FLIP LOGIC ---
                // If user doesn't flip manually within 5 seconds, do it for them.
                setTimeout(() => {
                    if (!hasFlipped) {
                        triggerFlip();
                    }
                }, 5000);
            });

            // --- FLIP CARD ---
            function triggerFlip() {
                cardInner.parentNode.classList.toggle('card-flipped');
                hasFlipped = true;
            }



            // Consolidate click logic:
            // 1. If clicking Expand Button -> Lightbox (handled by its own listener, but we stop warning propagation there)
            // 2. If clicking Note (Back) -> Lightbox
            // 3. Else -> Flip
            
            cardContainer.addEventListener('click', (e) => {
               // Logic to check if we should expand or flip
               const isFlipped = cardInner.parentNode.classList.contains('card-flipped');
               // Check if the click target is the back-face image or within the back face
               const clickedBack = e.target.closest('.card-back');
               // Check if specific expand button was clicked (though it has its own listener, bubbling might reach here if not stopped)
               const clickedExpand = e.target.closest('#expand-btn');

               if (clickedExpand) {
                   // Handled by expandBtn listener, do nothing here
                   return;
               }

               if (isFlipped && clickedBack) {
                   // If we are looking at the note, tap opens Lightbox
                   openLightbox();
               } else {
                   // Otherwise (Front face, or margins), toggle flip
                   triggerFlip();
               }
            });

            // --- LIGHTBOX LOGIC ---
            function openLightbox() {
                lightboxImg.src = noteImg.src;
                lightbox.style.display = 'flex';
                // Small delay to allow display flex to apply before opacity transition
                requestAnimationFrame(() => {
                    lightbox.classList.remove('opacity-0');
                });
            }

            function closeLightbox() {
                lightbox.classList.add('opacity-0');
                setTimeout(() => {
                    lightbox.style.display = 'none';
                }, 300);
            }

            lightbox.addEventListener('click', closeLightbox);
            
            // Also trigger lightbox from the dedicated button (redundant but safe)
            expandBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openLightbox();
            });
        }
    </script>
</body>
</html>


